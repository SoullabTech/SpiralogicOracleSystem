/**
 * Mobile Browser Chrome Fixes
 * Handles Safari and Chrome UI overlays
 */

/* Use CSS environment variables for safe areas */
:root {
  --safe-area-top: env(safe-area-inset-top, 0px);
  --safe-area-right: env(safe-area-inset-right, 0px);
  --safe-area-bottom: env(safe-area-inset-bottom, 0px);
  --safe-area-left: env(safe-area-inset-left, 0px);

  /* Mobile browser chrome heights (approximate) */
  --ios-safari-top: 44px;
  --ios-safari-bottom: 100px;
  --android-chrome-top: 56px;
  --android-chrome-bottom: 56px;
}

/* Prevent scrolling issues on mobile */
html, body {
  height: 100%;
  overflow: hidden;
  overscroll-behavior: none;
  -webkit-overflow-scrolling: touch;
}

/* Use dynamic viewport height (dvh) for mobile browsers */
.mobile-container {
  height: 100vh;
  height: 100dvh; /* Dynamic viewport height */
  height: -webkit-fill-available; /* iOS Safari fallback */
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
}

/* Input area positioning - CRITICAL */
.input-area {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 1000;

  /* Add padding for browser UI and safe area */
  padding-bottom: calc(var(--safe-area-bottom) + 80px);

  /* Background to ensure visibility */
  background: linear-gradient(to top,
    rgba(17, 24, 39, 0.98) 0%,
    rgba(17, 24, 39, 0.95) 50%,
    rgba(17, 24, 39, 0) 100%);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
}

/* iOS specific fixes */
@supports (-webkit-touch-callout: none) {
  .input-area {
    /* Extra padding for iOS Safari */
    padding-bottom: calc(env(safe-area-inset-bottom, 20px) + 100px);
  }

  /* Handle the notch */
  .header-area {
    padding-top: calc(env(safe-area-inset-top, 20px) + 10px);
  }
}

/* Android Chrome specific */
@media screen and (max-width: 768px) {
  .input-area {
    /* Ensure input is above Android navigation bar */
    padding-bottom: calc(56px + 20px);
  }
}

/* Landscape orientation adjustments */
@media screen and (orientation: landscape) and (max-height: 500px) {
  .input-area {
    padding-bottom: calc(var(--safe-area-bottom) + 40px);
  }

  /* Reduce visual element size in landscape */
  .sacred-geometry {
    transform: scale(0.7);
  }
}

/* PWA/Standalone mode (no browser chrome) */
@media all and (display-mode: standalone) {
  .input-area {
    padding-bottom: calc(var(--safe-area-bottom) + 20px);
  }
}

/* Virtual keyboard handling */
.keyboard-visible .input-area {
  /* When keyboard is visible, reduce bottom padding */
  padding-bottom: var(--safe-area-bottom);
}

/* Focus states for mobile */
input:focus,
textarea:focus {
  /* Prevent zoom on iOS */
  font-size: 16px !important;
  transform: scale(1) !important;
}

/* Disable pull-to-refresh */
.main-content {
  overscroll-behavior-y: contain;
  touch-action: pan-y;
}

/* Button positioning for mobile */
.bottom-buttons {
  position: fixed;
  bottom: calc(var(--safe-area-bottom) + 140px); /* Above input area */
  right: 16px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  z-index: 999;
}

/* Adjust for keyboard visibility using Visual Viewport API */
@supports (height: 100dvh) {
  .with-keyboard {
    height: calc(100dvh - env(keyboard-inset-height, 0));
  }
}

/* Specific fixes for problem areas */
.input-container {
  /* Ensure input is always accessible */
  min-height: 60px;
  margin-bottom: 0;
  transform: translateZ(0); /* Force GPU layer */
}

/* Voice button positioning */
.voice-button-mobile {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  z-index: 10;
}

/* Send button positioning */
.send-button-mobile {
  margin-left: 8px;
  flex-shrink: 0;
}

/* Responsive text sizing */
@media screen and (max-width: 375px) {
  .input-area input,
  .input-area textarea {
    font-size: 16px; /* Prevent zoom on focus */
    padding: 12px 48px 12px 16px; /* Space for mic button */
  }
}

/* Handle the iPhone notch/Dynamic Island */
@supports (padding: max(0px)) {
  .header-area {
    padding-top: max(env(safe-area-inset-top), 20px);
  }

  .input-area {
    padding-bottom: max(env(safe-area-inset-bottom), 100px);
  }
}

/* Debug helper - shows safe areas */
.debug-safe-areas::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: var(--safe-area-top);
  background: rgba(255, 0, 0, 0.2);
  z-index: 9999;
}

.debug-safe-areas::after {
  content: '';
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: var(--safe-area-bottom);
  background: rgba(0, 255, 0, 0.2);
  z-index: 9999;
}