# Claude Code Prompts: Spiralogic Oracle System

## üéØ Quick Deploy Commands

### Context Primer (Always paste first)
```
You are my Claude Code deployment assistant for the Spiralogic Oracle System.

Project Structure:
- Monorepo with pnpm workspaces
- apps/web: Next.js frontend (Vercel deployment)
- apps/api: Backend API (Railway/Render soon)
- packages/shared: Shared types and utilities
- Stub API mode active by default for safety

Key Files:
- emergency-deploy.sh: Production deploy script
- emergency-redeploy.sh: Redeploy script
- vercel.json: Deployment config in apps/web

IMPORTANT: Always deploy from apps/web directory
```

## üì¶ Deployment Commands

### 1. Preview Deploy
```
Deploy apps/web to Vercel preview:
cd apps/web && vercel --preview --archive=tgz --yes && cd ../..
```

### 2. Production Deploy
```
Deploy apps/web to Vercel production:
cd apps/web && vercel --prod --archive=tgz --yes && cd ../..
```

### 3. Redeploy Latest
```
Redeploy apps/web with latest build:
cd apps/web && vercel deploy --archive=tgz --yes && cd ../..
```

### 4. Emergency Deploy (Full Reset)
```
Run emergency deployment script:
./emergency-deploy.sh
```

## üîç Debug Commands

### Check Deploy Logs
```
Show last 50 lines of deployment log and explain any errors:
tail -n 50 vercel-deploy.log
```

### Check Build Output
```
Show Vercel build output directory:
ls -la apps/web/.vercel/output/
```

### Verify Monorepo Links
```
Check pnpm workspace configuration:
cat pnpm-workspace.yaml
pnpm ls --depth 0
```

## üõ†Ô∏è Common Fixes

### Fix Vercel Config
```
Update apps/web/vercel.json for stub API mode.
Ensure buildCommand is "pnpm build" and outputDirectory is ".next"
```

### Fix Package Links
```
Rebuild monorepo dependencies:
pnpm install --frozen-lockfile
pnpm build
```

### Clear Cache & Rebuild
```
Clear all caches and rebuild:
rm -rf apps/web/.next apps/web/.vercel node_modules
pnpm install
cd apps/web && pnpm build && cd ../..
```

## üöÄ Backend Commands

### Start Local Backend
```
Start backend in stub mode:
cd apps/api && PORT=3002 npm run start:minimal
```

### Test Maya Endpoint
```
Test Maya activation endpoint:
curl -X POST http://localhost:3002/api/maya/activate \
  -H "Content-Type: application/json" \
  -d '{"message": "test"}'
```

### Check Sesame Status
```
Check Sesame CSM service:
curl http://localhost:3003/health
```

## üìã Task Templates

### Full Deploy Checklist
```
Create todo list for full deployment:
1. Run tests locally
2. Build apps/web locally
3. Deploy to preview
4. Test preview URL endpoints
5. Deploy to production
6. Verify production deployment
```

### Debug Failed Deploy
```
Debug deployment failure:
1. Check vercel-deploy.log for errors
2. Verify apps/web/package.json scripts
3. Check vercel.json configuration
4. Test local build with pnpm build
5. Clear cache if needed
6. Retry deployment
```

### Setup New Environment
```
Setup deployment for new environment:
1. Install Vercel CLI: npm i -g vercel
2. Link project: cd apps/web && vercel link
3. Set environment variables in Vercel dashboard
4. Configure vercel.json
5. Run test deployment
```

## üîë Environment Variables

### Required for Frontend (apps/web)
```
NEXT_PUBLIC_API_URL=https://api.example.com (or /api/stub for stub mode)
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
```

### Required for Backend (apps/api)
```
PORT=3002
HUGGING_FACE_API_KEY=your_hf_key
SUPABASE_URL=your_supabase_url
SUPABASE_SERVICE_KEY=your_service_key
```

## üì± Testing Endpoints

### Test Stub API
```
Test stub endpoints after deploy:
curl https://your-deployment.vercel.app/api/stub/test
curl https://your-deployment.vercel.app/api/stub/maya/activate
```

### Test Health Check
```
Check deployment health:
curl https://your-deployment.vercel.app/api/health
```

## üéØ Quick Wins

### Deploy in 30 seconds
```
cd apps/web && vercel --prod --archive=tgz --yes && cd ../.. && echo "Deployed!"
```

### Check if site is live
```
curl -I https://web-9xm7poa4l-spiralogic-oracle-system.vercel.app
```

### View live logs
```
vercel logs --follow
```

## üí° Pro Tips

1. **Always deploy from apps/web** - Vercel needs to be in the right directory
2. **Use --archive=tgz** - Faster uploads, smaller packages
3. **Stub mode first** - Test with stubs before connecting real backend
4. **Check logs immediately** - Don't wait for timeouts
5. **Keep this file open** - Reference during deployments

## ü§ñ CI/CD Automation

### Generate GitHub Actions Workflow
```
Create a GitHub Actions workflow for automated deployments:
1. Create .github/workflows/deploy.yml
2. Add build and test steps for monorepo
3. Deploy to Vercel on push to main
4. Run tests before deployment
5. Send Slack/Discord notifications on success/failure
```

### Check Existing CI/CD
```
Analyze current CI/CD setup and suggest improvements:
- Check for .github/workflows/*.yml files
- Review package.json scripts for CI commands
- Suggest missing test coverage
- Recommend security scanning steps
```

### Create PR Checks
```
Setup automated PR validation:
1. Lint checks (ESLint, Prettier)
2. Type checking (TypeScript)
3. Unit test execution
4. Build verification
5. Bundle size analysis
```

## üî• Error Triage & Analysis

### Summarize Build Failure
```
Analyze the last 100 lines of Vercel build logs and provide:
1. Root cause of failure
2. Specific error messages
3. Suggested fixes in order of likelihood
4. Commands to run locally to reproduce
```

### Debug Memory Issues
```
Diagnose out-of-memory errors in build:
- Check package.json for memory limits
- Add NODE_OPTIONS="--max-old-space-size=4096"
- Identify memory-heavy dependencies
- Suggest build optimization strategies
```

### Trace Dependency Conflicts
```
Find and fix package version conflicts:
pnpm why [package-name]
npm ls [package-name]
Check for duplicate dependencies and suggest resolutions
```

### Analyze Performance Issues
```
Profile slow build/deploy times:
1. Time each build step
2. Identify bottlenecks
3. Suggest parallel processing opportunities
4. Recommend caching strategies
```

## üß™ AI Test Generation

### Generate Component Tests
```
Create unit tests for React component at [path]:
1. Analyze component props and state
2. Generate Jest/React Testing Library tests
3. Cover happy path and edge cases
4. Add accessibility tests
5. Include snapshot tests if appropriate
```

### Create API Endpoint Tests
```
Generate tests for API endpoint:
1. Analyze endpoint at apps/api/[route]
2. Create unit tests for handler logic
3. Add integration tests with mock data
4. Test error handling scenarios
5. Validate response schemas
```

### Generate E2E Test Suite
```
Create Playwright/Cypress E2E tests:
1. Test critical user flows
2. Add visual regression tests
3. Test responsive breakpoints
4. Validate form submissions
5. Check API integrations
```

### Coverage Analysis
```
Analyze test coverage and suggest new tests:
pnpm test:coverage
Identify uncovered code paths
Prioritize critical business logic
Generate tests for uncovered areas
```

## üîê Security Audit Prompts

### Scan for Exposed Secrets
```
Security audit for exposed credentials:
1. Check all .env* files for committed secrets
2. Scan code for hardcoded API keys
3. Review git history for previously exposed secrets
4. Check public repos for leaked credentials
5. Suggest secret rotation if needed
```

### Environment Variable Audit
```
Validate environment configuration:
1. List all required env vars across monorepo
2. Check for missing variables in production
3. Identify unused environment variables
4. Validate env var naming conventions
5. Suggest .env.example updates
```

### Dependency Security Check
```
Audit npm packages for vulnerabilities:
pnpm audit
npm audit fix --force (if safe)
Check for outdated packages with known CVEs
Suggest alternative packages if needed
Create security update PR
```

### API Security Review
```
Analyze API endpoints for security issues:
1. Check for authentication on all routes
2. Validate input sanitization
3. Review CORS configuration
4. Check rate limiting implementation
5. Audit data exposure in responses
```

### Frontend Security Scan
```
Review frontend for security vulnerabilities:
1. Check for XSS vulnerabilities
2. Validate CSP headers
3. Review cookie security settings
4. Check for exposed sensitive data in bundle
5. Audit third-party script usage
```

## üöÄ Advanced Automation

### Auto-fix Linting Issues
```
Automatically fix all linting and formatting issues:
pnpm lint:fix
pnpm format
Commit changes with message "fix: auto-fix linting issues"
```

### Generate API Documentation
```
Create OpenAPI/Swagger documentation:
1. Analyze all API routes in apps/api
2. Generate OpenAPI spec
3. Create interactive Swagger UI
4. Add request/response examples
5. Include authentication documentation
```

### Database Migration Generator
```
Generate database migration from schema changes:
1. Compare current schema with previous version
2. Generate migration SQL
3. Create rollback script
4. Add migration to version control
5. Test migration on local database
```

### Performance Optimization Bot
```
Analyze and optimize bundle size:
1. Run bundle analyzer
2. Identify large dependencies
3. Suggest code splitting points
4. Recommend lazy loading opportunities
5. Generate optimization PR
```

## üìä Monitoring & Analytics

### Setup Error Tracking
```
Configure Sentry or similar error tracking:
1. Install error tracking SDK
2. Configure for both frontend and backend
3. Set up error boundaries
4. Add custom error context
5. Create alert rules
```

### Generate Performance Metrics
```
Add performance monitoring:
1. Implement Core Web Vitals tracking
2. Add custom performance marks
3. Setup Real User Monitoring (RUM)
4. Create performance dashboard
5. Set performance budgets
```

## üé® Code Quality Prompts

### Refactor Suggestions
```
Analyze code and suggest refactoring:
1. Identify code smells
2. Find duplicate code blocks
3. Suggest design pattern improvements
4. Recommend function extractions
5. Propose better naming conventions
```

### Type Safety Audit
```
Improve TypeScript type coverage:
1. Find all 'any' types and suggest proper types
2. Add missing type definitions
3. Convert JS files to TS
4. Add strict mode if not enabled
5. Generate type guards for runtime validation
```

## üîó Important URLs

- Production: https://web-9xm7poa4l-spiralogic-oracle-system.vercel.app
- Vercel Dashboard: https://vercel.com/dashboard
- GitHub Repo: [Your GitHub URL]

---

Last Updated: 2025-09-07
Version: 2.0.0 (Enhanced with AI DevOps capabilities)